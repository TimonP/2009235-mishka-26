//Проверка формы

(() => {
  const input_required = document.querySelectorAll('.input[required]');
  const button_submit = document.querySelector('.button[type="submit"]');

  if (!input_required.length) return;

  button_submit.addEventListener('click', () => {
    input_required.forEach((input) => {
      if (input.value == '') {
        input.classList.add('input--invalid');
      }
      else {
        input.classList.remove('input--invalid');
      }
    })
  });

  input_required.forEach((input) => {
    input.addEventListener('change', () => {
      if (input.validity.valid) {
        input.classList.remove('input--invalid');
      }
    })
  })
})();

(() => {
  const map = document.querySelector('#map');
  if (!map) return;

  ymaps.ready(init);
  function init() {
    var desktop_width = 1150;
    var tablet_width = 768;

    var myMap = new ymaps.Map('map', {
      center: [59.938788, 30.323126],
      zoom: 16.5,
      controls: []
    });

    myPlacemark = new ymaps.Placemark([59.938635, 30.323118], {
      hintContent: 'Мы тут'
      }, {
      iconLayout: 'default#image',
      iconImageHref: 'img/map-pin.svg',
      iconImageSize: [67, 101],
      iconImageOffset: [-30, -100]
    });

    myMap.geoObjects.add(myPlacemark);

    start();
    window.addEventListener('resize', start);
    function start() {
      if (document.documentElement.clientWidth >= desktop_width) {
        myMap.setCenter([59.938788, 30.323126], 16,);
      }

      else if (document.documentElement.clientWidth < desktop_width && document.documentElement.clientWidth >= tablet_width) {
        myMap.setCenter([59.938788, 30.323126], 16.5,);
      }

      else {
        myMap.setCenter([59.938788, 30.323126], 17.3,);
      }
    }
  }
})();

(() => {
  const modal_open_buttons = document.querySelectorAll('#modal-size-button');
  const modal_window = document.querySelector('.modal');

  if (!modal_open_buttons.length) return;

  function openModal(modal) {
    modal.classList.remove('modal--close');
    document.addEventListener('keydown', closeByEscape);
  }

  function closeModal(modal) {
    modal.classList.add('modal--close');
    document.removeEventListener('keydown', closeByEscape);
  }

  modal_open_buttons.forEach((button) => {
    button.addEventListener('click', (e) => {
      e.stopPropagation();
      openModal(modal_window);
    })
  })

  modal_window.addEventListener('click', (e) => {
    if (!modal_window.classList.contains('modal--close') && e.target == e.currentTarget) {
      closeModal(modal_window);
    }
  })

  function closeByEscape(e) {
    if (!modal_window.classList.contains('modal--close') && e.key === 'Escape') {
      closeModal(modal_window);
    }
  }
})();

(() => {
  const heder_menu = document.querySelectorAll('.main-nav__list.site-list a');
  const introduction_menu = document.querySelectorAll('.introduction__site-list a');

  if (!heder_menu||!introduction_menu) return;

  var desktop_width = 1150;
  var tablet_width = 768;

  for (let i = 0; i <= heder_menu.length - 1; i++) {
    const origin_innerHTML = introduction_menu[i].innerHTML;
    const origin_href = introduction_menu[i].href;

    start();
    window.addEventListener('resize', start);
    function start() {
      if (document.documentElement.clientWidth < desktop_width && document.documentElement.clientWidth >= tablet_width) {
        for (let i = 0; i <= heder_menu.length - 1; i++) {
          introduction_menu[i].innerHTML = heder_menu[i].innerHTML;
          introduction_menu[i].href = heder_menu[i].href;
        }
      }

      else {
        for (let i = 0; i <= heder_menu.length - 1; i++) {
          introduction_menu[i].innerHTML = origin_innerHTML;
          introduction_menu[i].href = origin_href;
        }
      }
    }
  }
})();

(() => {
  const noJS = document.querySelector('.main-nav');
  const main_menu = document.querySelector('.main-nav__wrapper');
  const main_button = document.querySelector('.main-nav__toggle');

  if (!main_button) return;

  noJS.classList.remove('main-nav--no-js');

  main_button.addEventListener('click', () => {
    main_menu.classList.toggle('main-nav__wrapper--opened');
    if (main_menu.classList.contains('main-nav__wrapper--opened')) {
      main_menu.classList.remove('main-nav__wrapper--closed');
      }

    else {
      main_menu.classList.add('main-nav__wrapper--closed');
    }

    main_button.classList.toggle('main-nav__toggle--closed');
    main_button.classList.toggle('main-nav__toggle--opened');
  })
})();
